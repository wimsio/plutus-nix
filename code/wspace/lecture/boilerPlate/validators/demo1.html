<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Coxy Plutus Playground</title>

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --border-radius: 0.75rem;
      --border-color: #e0e0e0;
      --bg-light: #fafafa;
      --accent: #2563eb;
      --pink: #ffbaf8;
    }

    * { box-sizing: border-box; }

    .hidden {
      display: none;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 1rem;
      background: #f5f5f5;
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      background: #fff;
      border-radius: 1.5rem;
      border: 1px solid var(--border-color);
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
      padding: 1.25rem 1.5rem 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .header-row {
      text-align: center;
    }

    .header-row h2 {
      margin: 0;
      font-size: 1.2rem;
    }

    /* Generic row/column layout */
    .row {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .row--3 > .col {
      width: 100%;
    }

    @media (min-width: 900px) {
      .row--3 {
        flex-direction: row;
      }
      .row--3 > .col {
        flex: 1;
      }
    }

    /* Step blocks (row 1) */
    .step-block {
      border: 1px solid var(--border-color);
      border-radius: 1.25rem;
      padding: 0.8rem 1rem;
      background: #fff;
    }

    .step-title {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 0.35rem;
    }

    .step-subtitle {
      font-size: 0.85rem;
      color: #555;
    }

    .step-row {
      margin-top: 0.4rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    input[type="text"],
    select {
      width: 100%;
      padding: 0.6rem 0.75rem;
      border-radius: 0.5rem;
      border: 1px solid var(--border-color);
      font-size: 0.9rem;
      background: #fff;
    }

    /* Pink square toggle for custom industry */
    .custom-toggle-label {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      cursor: pointer;
      font-size: 0.85rem;
    }

    .custom-toggle-label input[type="checkbox"] {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }

    .custom-toggle-box {
      width: 32px;
      height: 32px;
      border-radius: 0.3rem;
      background: var(--pink);
      border: 1px solid #e38fdc;
      box-shadow: 0 0 0 1px rgba(0,0,0,0.03);
      transition: transform 0.08s ease, box-shadow 0.12s ease;
    }

    .custom-toggle-label input[type="checkbox"]:checked + .custom-toggle-box {
      box-shadow: 0 0 0 2px rgba(37,99,235,0.35);
      transform: scale(1.03);
    }

    /* Subpanels */
    .subpanel {
      border: 1px solid var(--border-color);
      border-radius: 0.75rem;
      padding: 0.75rem;
      background: var(--bg-light);
    }

    .subpanel h3 {
      margin: 0 0 0.5rem;
      font-size: 0.95rem;
    }

    .subpanel h4 {
      margin: 0.5rem 0 0.25rem;
      font-size: 0.9rem;
    }

    .custom-prop-row {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      margin-bottom: 0.5rem;
    }

    .custom-prop-row input[type="text"] {
      width: 100%;
      padding: 0.5rem 0.6rem;
      border-radius: 0.5rem;
      border: 1px solid var(--border-color);
      font-size: 0.85rem;
      background: #fff;
    }

    .custom-prop-row select {
      font-size: 0.85rem;
    }

    small {
      font-size: 0.78rem;
      color: #555;
    }

    .toggle {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.85rem;
      cursor: pointer;
      margin-bottom: 0.25rem;
    }

    .toggle input[type="checkbox"] {
      width: 1.1rem;
      height: 1.1rem;
    }

    /* Datum & Redeemer inner bits */
    #datum-area label {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.85rem;
      margin-bottom: 0.25rem;
    }

    #datum-area input[type="checkbox"] {
      width: 1.1rem;
      height: 1.1rem;
    }

    .action-block {
      border: 1px solid var(--border-color);
      border-radius: 0.75rem;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      background: #fff;
    }

    .action-block h4 {
      margin: 0 0 0.4rem;
      font-size: 0.9rem;
    }

    .action-block label {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.85rem;
      margin-bottom: 0.25rem;
    }

    .action-block input[type="checkbox"] {
      width: 1.1rem;
      height: 1.1rem;
    }

    /* Textareas */
    textarea {
      width: 100%;
      min-height: 140px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.8rem;
      padding: 0.7rem;
      border-radius: 0.5rem;
      border: 1px solid var(--border-color);
      background: #fcfcfc;
      resize: vertical;
      overflow-x: auto;
    }

    #haskell-output {
      min-height: 200px;
    }

    #haskell-full-output {
      min-height: 260px;
      height: 60vh;
    }

    /* Buttons */
    .primary-btn {
      padding: 0.45rem 1.1rem;
      border-radius: 999px;
      border: none;
      font-size: 0.9rem;
      font-weight: 600;
      color: #fff;
      background: var(--accent);
      cursor: pointer;
    }

    .primary-btn:active {
      transform: scale(0.98);
    }

    .secondary-btn {
      padding: 0.35rem 0.9rem;
      border-radius: 999px;
      border: 1px solid var(--border-color);
      font-size: 0.8rem;
      background: #fff;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      margin-top: 0.4rem;
    }

    .secondary-btn:active {
      transform: scale(0.98);
    }

    .panel-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="header-row">
      <h2>Coxy Haskell Plutus Builder</h2>
    </div>

    <!-- ROW 1: 1) Search  2) Industry  3) Custom toggle -->
    <div class="row row--3">
      <!-- Column 1: Search -->
      <div class="col">
        <div class="step-block">
          <div class="step-title">1. Search Smart Contract Or Industry</div>
          <div class="step-row">
            <input
              type="text"
              id="industry-search"
              placeholder="Search..."
              autocomplete="off"
            />
          </div>
        </div>
      </div>

      <!-- Column 2: Industry select -->
      <div class="col">
        <div class="step-block">
          <div class="step-title">2. Smart Contract Industry</div>
          <div class="step-subtitle">Select smart contract industry</div>
          <div class="step-row">
            <select id="industry"></select>
          </div>
        </div>
      </div>

      <!-- Column 3: Custom toggle only -->
      <div class="col">
        <div class="step-block">
          <div class="step-title">3. Create Custom Smart Contract</div>
          <div class="step-row" style="justify-content: space-between;">
            <span class="step-subtitle">Create custom smart contract / industry</span>
            <label class="custom-toggle-label">
              <input type="checkbox" id="enable-custom-industry" />
              <span class="custom-toggle-box"></span>
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- ROW 2 (CUSTOM): Contract title / Datum / Redeemer  -->
    <!-- Hidden by default; same id that JS already toggles -->
    <div id="custom-industry-section" class="row row--3 hidden">
      <!-- Column 1: Contract title & type names -->
      <div class="col">
        <div class="subpanel">
          <h3>Custom Contract Title</h3>

          <div class="custom-prop-row">
            <label for="custom-contract-title">Contract title (for UI / Haskell module)</label>
            <input
              type="text"
              id="custom-contract-title"
              placeholder="e.g. CustomEscrow, MyAmmValidator"
            />
          </div>

          <div class="custom-prop-row">
            <input
              type="text"
              id="custom-industry-id"
              placeholder="Industry id (e.g. customEscrow)"
            />
            <input
              type="text"
              id="custom-industry-label"
              placeholder="Industry label (e.g. Custom Escrow Contract)"
            />
          </div>

          <div class="custom-prop-row">
            <input
              type="text"
              id="custom-datum-type"
              placeholder="Datum type name (e.g. CustomDatum)"
            />
            <input
              type="text"
              id="custom-redeemer-type"
              placeholder="Redeemer type name (e.g. CustomRedeemer)"
            />
          </div>
        </div>
      </div>

      <!-- Column 2: Custom datum -->
      <div class="col">
        <div class="subpanel">
          <h3>Custom Datum</h3>
          <small>
            Add as many datum fields as you want. Each field has a name and a Plutus type.
          </small>

          <div id="custom-industry-datum-list">
            <div class="custom-prop-row custom-industry-datum-row">
              <input
                type="text"
                class="cid-name"
                placeholder="Field name e.g. seller"
              />
              <select class="cid-type">
                <option value="">Select Plutus type…</option>
                <option>Integer</option>
                <option>Bool</option>
                <option>BuiltinByteString</option>
                <option>POSIXTime</option>
                <option>POSIXTimeRange</option>
                <option>PubKeyHash</option>
                <option>ScriptHash</option>
                <option>CurrencySymbol</option>
                <option>TokenName</option>
                <option>Value</option>
                <option>AssetClass</option>
                <option>Address</option>
                <option>StakingCredential</option>
                <option>BuiltinData</option>
                <option>TxOutRef</option>
                <option>Maybe Integer</option>
                <option>Maybe PubKeyHash</option>
                <option>TxId</option>
                <option>TxInfo</option>
                <option>TxOut</option>
                <option>TxInInfo</option>
                <option>OutputDatum</option>
                <option>Maybe ScriptHash</option>
                <option>Lovelace</option>
                <option>Ada</option>
                <option>Interval</option>
                <option>Slot</option>
                <option>Time</option>
                <option>ValidatorHash</option>
                <option>LowerBound a</option>
                <option>UpperBound a</option>
                <option>Natural</option>
                <option>Credential</option>
                <option>StakingHash</option>
              </select>
            </div>
          </div>

          <button type="button" id="add-custom-industry-datum" class="secondary-btn">
            + Add datum field
          </button>
        </div>
      </div>

      <!-- Column 3: Custom redeemer -->
      <div class="col">
        <div class="subpanel">
          <h3>Custom Redeemer</h3>
          <small>
            Add one or more redeemer constructors (e.g. PaySeller, RefundBuyer).
          </small>

          <div id="custom-industry-actions-list">
            <div class="custom-prop-row custom-industry-action-row">
              <input
                type="text"
                class="cia-name"
                placeholder="Action name e.g. PaySeller"
              />
              <input
                type="text"
                class="cia-label"
                placeholder="Label / description (optional)"
              />
            </div>
          </div>

          <button type="button" id="add-custom-industry-action" class="secondary-btn">
            + Add action
          </button>
        </div>
      </div>
    </div>

    <!-- ROW 3: Datum / Redeemer / Preview (unchanged) -->
    <div class="row row--3">
      <!-- Datum panel -->
      <div class="col">
        <div class="subpanel" id="datum-panel">
          <h3>Datum</h3>

          <div class="custom-datum">
            <label class="toggle">
              <input type="checkbox" id="enable-custom-datum">
              <span>Enable custom datum fields (advanced)</span>
            </label>

            <div id="custom-datum-section" class="hidden">
              <small>
                Add extra datum fields not covered by the templates.
                These will appear in the datum JSON as <code>customFields</code>.
              </small>

              <div id="custom-datum-list">
                <div class="custom-prop-row">
                  <input
                    type="text"
                    class="custom-datum-name"
                    placeholder="Field name e.g. extraInfo"
                    disabled
                  />
                  <select class="custom-datum-type" disabled>
                    <option value="">Select Plutus type…</option>
                    <option>Integer</option>
                    <option>Bool</option>
                    <option>BuiltinByteString</option>
                    <option>POSIXTime</option>
                    <option>POSIXTimeRange</option>
                    <option>PubKeyHash</option>
                    <option>ScriptHash</option>
                    <option>CurrencySymbol</option>
                    <option>TokenName</option>
                    <option>Value</option>
                    <option>AssetClass</option>
                    <option>Address</option>
                    <option>StakingCredential</option>
                    <option>BuiltinData</option>
                    <option>TxOutRef</option>
                    <option>Maybe Integer</option>
                    <option>Maybe PubKeyHash</option>
                    <option>TxId</option>
                    <option>TxInfo</option>
                    <option>TxOut</option>
                    <option>TxInInfo</option>
                    <option>OutputDatum</option>
                    <option>Maybe ScriptHash</option>
                    <option>Lovelace</option>
                    <option>Ada</option>
                    <option>Interval</option>
                    <option>Slot</option>
                    <option>Time</option>
                    <option>ValidatorHash</option>
                    <option>LowerBound a</option>
                    <option>UpperBound a</option>
                    <option>Natural</option>
                    <option>Credential</option>
                    <option>StakingHash</option>
                  </select>
                </div>
              </div>

              <button type="button" id="add-custom-datum" class="secondary-btn">
                Add another datum field
              </button>
            </div>
          </div>

          <!-- Param datum -->
          <div class="param-datum" style="margin-top:0.5rem;">
            <label class="toggle">
              <input type="checkbox" id="enable-param-datum">
              <span>Generate parameter datum type (CoxyParamDatum)</span>
            </label>
            <small>
              When enabled, the validator type becomes:
              <code>CoxyParamDatum -> CoxyDatum -> CoxyRedeemer -> ScriptContext -> Bool</code>.
              Define fields below for <code>CoxyParamDatum</code>.
            </small>

            <div id="param-datum-section" class="hidden">
              <small>
                Fields for <code>CoxyParamDatum</code> (e.g. <code>cpBuyer :: PubKeyHash</code>,
                <code>cpAmount :: Integer</code>).
              </small>

              <div id="param-datum-list">
                <div class="custom-prop-row param-datum-row">
                  <input
                    type="text"
                    class="param-name"
                    placeholder="Field name e.g. buyer"
                    disabled
                  />
                  <input
                    type="text"
                    class="param-type"
                    placeholder="Haskell type e.g. PubKeyHash"
                    disabled
                  />
                </div>
              </div>

              <button type="button" id="add-param-datum" class="secondary-btn">
                Add parameter datum field
              </button>
            </div>
          </div>

          <div id="datum-area" style="margin-top:0.5rem;"></div>
        </div>
      </div>

      <!-- Redeemer panel -->
      <div class="col">
        <div class="subpanel" id="redeemer-panel">
          <h3>Redeemer</h3>

          <div class="custom-redeemer">
            <label class="toggle">
              <input type="checkbox" id="enable-custom-redeemer">
              <span>Enable custom redeemer actions (advanced)</span>
            </label>

            <div id="custom-redeemer-section" class="hidden">
              <small>
                Define extra redeemer constructors for special cases.
                These will appear in the redeemer JSON as <code>customActions</code>.
              </small>

              <div id="custom-redeemer-list">
                <div class="custom-prop-row">
                  <input type="text" placeholder="Action name e.g. EmergencyClose" disabled />
                  <input type="text" placeholder="Description (optional)" disabled />
                </div>
              </div>

              <button type="button" id="add-custom-redeemer" class="secondary-btn">
                Add another action
              </button>
            </div>
          </div>

          <div id="actions-area" style="margin-top:0.5rem;"></div>
        </div>
      </div>

      <!-- Preview panel -->
      <div class="col">
        <div class="subpanel" id="preview-panel">
          <h3>Preview</h3>
          <small>
            This space is reserved for any visual or textual preview you may want to add
            (e.g. a human-readable summary of the current contract).
          </small>
        </div>
      </div>
    </div>

    <!-- ROW 4 (your previous "row 3"): JSON + mkValidator preview -->
    <div class="row row--3">
      <div class="col">
        <div class="subpanel">
          <h3>Datum JSON</h3>
          <textarea id="datum-json-output" readonly></textarea>
        </div>
      </div>

      <div class="col">
        <div class="subpanel">
          <h3>Redeemer JSON</h3>
          <textarea id="redeemer-json-output" readonly></textarea>
        </div>
      </div>

      <div class="col">
        <div class="subpanel">
          <div class="panel-header-row">
            <h3>Haskell mkValidator Preview</h3>
            <button id="generate" type="button" class="primary-btn">
              Generate Logic Spec
            </button>
          </div>
          <textarea id="haskell-output" readonly></textarea>
        </div>
      </div>
    </div>

    <!-- ROW 5 (your previous "row 4"): Full module -->
    <div class="row">
      <div class="col">
        <div class="subpanel">
          <div class="panel-header-row">
            <h3>Full Haskell Plutus Module</h3>
            <button id="download-hs" type="button" class="secondary-btn">
              Download ValidatorLogic.hs
            </button>
          </div>
          <textarea id="haskell-full-output" readonly></textarea>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="coxypp.js"></script>
</body>
</html>
